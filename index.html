<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Space Factory</title>
<style>
:root{
  --bg1:#071028;
  --bg2:#021428;
  --accent:#6fb3ff;
  --muted:#9fb5d9;
  --grad-a:linear-gradient(135deg,#071028,#0b1840);
}
html,body{height:100%;margin:0;font-family:ui-monospace,monospace;background:var(--bg1);color:#eaf4ff;transition:background 1s ease;}
header{padding:16px;text-align:center;background:rgba(255,255,255,0.02);border-bottom:1px solid rgba(255,255,255,0.03);}
h1{margin:0;font-size:clamp(18px,3vw,28px);}
.muted{color:var(--muted);font-size:13px;}
.wrap{display:flex;gap:14px;padding:14px;flex-wrap:wrap;justify-content:center;}
.panel{background:rgba(255,255,255,0.03);border-radius:10px;padding:12px;width:320px;box-shadow:0 6px 18px rgba(0,0,0,0.6);min-height:140px;}
.wide{width:700px;}
.sectionTitle{font-weight:800;margin:6px 0;}
button{background:linear-gradient(180deg,var(--accent),#4e8fe3);border:0;color:#02112a;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700;margin:6px 0;}
button.small{padding:6px 8px;font-size:13px;}
button.admin{background:red;color:white;}
button:disabled{opacity:0.45;cursor:not-allowed;}
.resource{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.03);}
.log{height:130px;overflow:auto;background:rgba(255,255,255,0.01);padding:8px;border-radius:6px;font-size:13px;}
.smallmuted{font-size:12px;color:var(--muted);}
.badge{display:inline-block;padding:4px 8px;border-radius:8px;background:rgba(255,255,255,0.03);margin:4px 2px;}
.egg{padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);margin:6px 0;}
.alienCard{padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);margin:6px 0;display:flex;justify-content:space-between;}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#081428;padding:18px;border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,0.7);z-index:40;width:80%;max-width:700px;}
.hidden{display:none;}
input[type="text"]{padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);width:190px;}
.brainrot{position:fixed;left:12px;bottom:12px;color:#ffd6d6;font-weight:700;pointer-events:none;z-index:20;}
.asciiBox{font-family:monospace;font-size:12px;line-height:12px;color:#dff3ff;padding:8px;background:rgba(0,0,0,0.2);border-radius:6px;pointer-events:none;}
.howto{font-size:14px;line-height:1.4;}
.equipBtn{background:#ffd27d;color:#02112a;border-radius:6px;padding:6px 8px;font-weight:800;}
footer{padding:8px;text-align:center;color:var(--muted);font-size:12px;}
</style>
</head>
<body>

<header>
  <h1 id="title">ðŸŒŒ Space Factory</h1>
  <div class="muted">Enter username (admin: hidden)</div>
  <div style="margin-top:8px">
    <input id="usernameInput" placeholder="Your name">
    <button class="small" onclick="setUsername()">Set Username</button>
    <button class="small" onclick="openHowTo()">How to Play</button>
  </div>
</header>

<div class="wrap">

  <!-- LEFT: resources & factories -->
  <div class="panel">
    <div class="sectionTitle">Resources</div>
    <div id="resources"></div>

    <div style="margin-top:8px;">
      <button onclick="manualMine()">ðŸ’Ž Mine Ore</button>
      <button onclick="manualEnergy()">âš¡ Generate Energy</button>
    </div>

    <hr>
    <div class="sectionTitle">Factories (auto)</div>
    <div id="factories"></div>
  </div>

  <!-- CENTER: Generators, eggs, aliens -->
  <div class="panel wide">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="sectionTitle">Alien Generators & Eggs</div>
        <div class="smallmuted">Generators produce eggs. Wait until an egg becomes ready then click <strong>HATCH</strong>.</div>
      </div>
      <div class="smallmuted">Autosave every 10s</div>
    </div>

    <div style="display:flex;gap:12px;margin-top:8px">
      <div style="flex:1">
        <div class="sectionTitle">Generators</div>
        <div id="generators"></div>
      </div>

      <div style="flex:1">
        <div class="sectionTitle">Eggs (click to hatch)</div>
        <div id="eggs"></div>
        <button class="small" onclick="unlockAllEggs()">Unlock All Eggs</button>
      </div>
    </div>

    <hr>
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="flex:1">
        <div class="sectionTitle">Collected Aliens</div>
        <div id="collected" class="muted"></div>
      </div>
      <div style="width:260px">
        <div class="sectionTitle">Equip</div>
        <div class="smallmuted">Choose an alien to equip (changes smooth background gradient).</div>
        <div id="equipList"></div>
      </div>
    </div>

    <hr>
    <div class="sectionTitle">Log</div>
    <div id="log" class="log"></div>
  </div>

  <!-- RIGHT: station, achievements, shop -->
  <div class="panel">
    <div class="sectionTitle">Space Station (one-time cosmetic purchases)</div>
    <div id="station"></div>

    <hr>
    <div class="sectionTitle">Achievements</div>
    <div id="achievements" class="muted"></div>

    <hr>
    <div class="sectionTitle">Controls</div>
    <div class="smallmuted">
      <button class="small" onclick="saveNow()">Save Now</button>
      <button class="small" onclick="resetGame()">Reset Save</button>
      <span id="adminPanelBtn"></span>
    </div>
  </div>
</div>

<div id="brainrot" class="brainrot"></div>
<div id="asciiArt" style="position:fixed;right:12px;top:120px"></div>

<div id="howto" class="modal hidden">
  <h2>How to Play</h2>
  <div class="howto">
    <ol>
      <li>Set your username (admin powers are hidden).</li>
      <li>Mine Ore & Generate Energy manually or use factories.</li>
      <li>Buy & upgrade Alien Generators â€” they produce eggs.</li>
      <li>Click HATCH on ready eggs to get aliens.</li>
      <li>Collected aliens give bonuses & can be equipped to change background.</li>
      <li>Space Station items are cosmetic one-time purchases with fun effects.</li>
      <li>Unlock achievements by hatching aliens, building factories, and more.</li>
    </ol>
    <p class="smallmuted">Tip: generator costs scale with each upgrade.</p>
  </div>
  <div style="margin-top:10px;text-align:right">
    <button onclick="closeHowTo()">Close</button>
  </div>
</div>

<footer>Refined text-based play â€” have fun! (Autosaves every 10s)</footer>

<script>
/* ==========================
GAME STATE
========================== */
const SAVE_KEY='space_factory_refined_save_v2';
let state={
  username:'Player',
  isAdmin:false,
  resources:{ore:100,metal:20,energy:50,crystal:0,alloy:0,circuit:0,fuelCell:0,shipPart:0,aiCore:0,nanofiber:0,quantumGel:0,darkMatter:0,hyperalloy:0,galaxyCoin:0},
  factories:{oreFactory:0,energyGen:0,smelter:0,crystalExtractor:0,circuitFoundry:0,alloyForge:0,fuelProcessor:0,nanofiberLoom:0,quantumSynth:0,darkMatterHarvester:0,hyperalloyReactor:0,shipyard:0,galaxyMine:0},
  generators:{basicGen:{level:0,baseCost:{metal:50,energy:20},baseInterval:8},
              advancedGen:{level:0,baseCost:{metal:500,alloy:20,energy:200},baseInterval:20},
              exoticGen:{level:0,baseCost:{alloy:500,circuit:50,energy:500},baseInterval:40}},
  eggs:[],
  aliens:[],
  equippedAlienId:null,
  station:{},
  achievements:[],
  lastSaved:null,
  upgrades:{}
};

/* ==========================
DATA DEFINITIONS
========================== */
const alienPool=[
{name:'Glorp',rarity:'common',bonus:{ore:1},colorA:'#6f3cff',colorB:'#1a0f3b'},
{name:'Vunxi',rarity:'uncommon',bonus:{crystal:0.8},colorA:'#0fffd3',colorB:'#012a2a'},
{name:'Xyroth',rarity:'rare',bonus:{alloy:0.5},colorA:'#ffd27d',colorB:'#3a2b00'},
{name:'Quarnax',rarity:'epic',bonus:{darkMatter:0.05},colorA:'#9d4cff',colorB:'#10002b'},
{name:'Omnicron Prime',rarity:'legendary',bonus:{hyperalloy:0.2},colorA:'#00ffd5',colorB:'#ff00b7'}
];
const factoriesDef={oreFactory:{name:'Ore Factory',cost:{ore:20},produce:{ore:1}},
energyGen:{name:'Energy Generator',cost:{ore:10},produce:{energy:1}},
smelter:{name:'Smelter',cost:{ore:50,energy:10},consume:{ore:3},produce:{metal:1}},
crystalExtractor:{name:'Crystal Extractor',cost:{ore:120,metal:40},produce:{crystal:0.25}},
circuitFoundry:{name:'Circuit Foundry',cost:{metal:200,crystal:50,energy:40},consume:{metal:1,crystal:1},produce:{circuit:1}},
alloyForge:{name:'Alloy Forge',cost:{metal:150,energy:60},consume:{metal:4},produce:{alloy:1}},
fuelProcessor:{name:'Fuel Processor',cost:{ore:100,energy:80},consume:{ore:3,energy:2},produce:{fuelCell:1}},
nanofiberLoom:{name:'Nanofiber Loom',cost:{alloy:1000,circuit:500,crystal:200},consume:{alloy:5,circuit:2,crystal:1},produce:{nanofiber:1}},
quantumSynth:{name:'Quantum Synthesizer',cost:{fuelCell:3000,metal:5000,crystal:2000},consume:{fuelCell:3,metal:5,crystal:1},produce:{quantumGel:1}},
darkMatterHarvester:{name:'Dark Matter Harvester',cost:{energy:1000000,metal:200000,aiCore:50000},consume:{energy:2000},produce:{darkMatter:1}},
hyperalloyReactor:{name:'Hyperalloy Reactor',cost:{nanofiber:2000,quantumGel:1000,alloy:2000},consume:{nanofiber:2,quantumGel:1,alloy:1},produce:{hyperalloy:1}},
shipyard:{name:'Shipyard',cost:{metal:5000,alloy:2000,energy:1000},consume:{metal:20,alloy:5,energy:50},produce:{shipPart:1}},
galaxyMine:{name:'Galaxy Mine',cost:{darkMatter:10,energy:5000},consume:{energy:500},produce:{galaxyCoin:1}}
};
const stationItems={
coffeeMachine:{name:'Coffee Machine',cost:{metal:50,energy:20},desc:'Every 10 minutes: "Your coffee is ready".'},
gym:{name:'Gym',cost:{metal:200,energy:50,circuit:10},desc:'Small passive energy multiplier.'},
retroArcade:{name:'Retro Arcade',cost:{metal:500,circuit:50},desc:'Adds retro background vibe.'},
hydroGarden:{name:'Hydroponic Garden',cost:{metal:300,crystal:10},desc:'Pretty plants.'},
robloxExperience:{name:'ROBLOX EXPERIENCEâ„¢',cost:{hyperalloy:5000,darkMatter:1,circuit:500,aiCore:10},desc:'Brainrot phrases every 5s.'},
artGallery:{name:'Art Gallery',cost:{metal:250,crystal:20},desc:'Shows ascii art every 60s.'},
observatory:{name:'Observatory',cost:{metal:600,crystal:100},desc:'Chance to find rare materials occasionally.'},
lab:{name:'Science Lounge',cost:{metal:800,crystal:200,energy:300},desc:'Small global production multiplier.'}
};

/* ==========================
UTILS
========================== */
function format(n){if(n>=1e9)return(n/1e9).toFixed(2)+'B';if(n>=1e6)return(n/1e6).toFixed(2)+'M';if(n>=1000)return(n/1000).toFixed(1)+'k';return Math.round(n*100)/100;}
function canAfford(cost){for(const k in cost)if((state.resources[k]||0)<cost[k])return false;return true;}
function payCost(cost){for(const k in cost)state.resources[k]=Math.max(0,(state.resources[k]||0)-cost[k]);}
function scaledCost(base,level){const out={};for(const k in base){out[k]=Math.ceil(base[k]*Math.pow(1.15,level));}return out;}
function randId(prefix='id'){return prefix+'_'+Math.random().toString(36).slice(2,9);}
function log(msg){const el=document.getElementById('log');const time=new Date().toLocaleTimeString();el.innerHTML=`[${time}] ${msg}`+el.innerHTML;}

/* ==========================
RENDER FUNCTIONS
========================== */
function renderResources(){const c=document.getElementById('resources');c.innerHTML='';for(const k in state.resources){const v=state.resources[k];const div=document.createElement('div');div.className='resource';div.innerHTML=`<div>${k}</div><div>${format(v)}</div>`;c.appendChild(div);}}
function renderFactories(){const c=document.getElementById('factories');c.innerHTML='';for(const k in factoriesDef){const f=factoriesDef[k];const cnt=state.factories[k]||0;const costText=Object.entries(f.cost).map(e=>`${e[1]} ${e[0]}`).join(' / ');const div=document.createElement('div');div.innerHTML=`<div style="font-weight:800">${f.name} x${cnt}</div><div class="smallmuted">Cost: <span class="price">${costText}</span></div><button class="small" onclick="buyFactory('${k}')">Buy ${f.name}</button>`;c.appendChild(div);}}
function prettyGenName(k){if(k==='basicGen')return'Basic Alien Generator';if(k==='advancedGen')return'Advanced Alien Generator';if(k==='exoticGen')return'Exotic Alien Generator';return k;}
function renderGenerators(){const c=document.getElementById('generators');c.innerHTML='';for(const k in state.generators){const g=state.generators[k];const cost=scaledCost(g.baseCost,g.level);const costText=Object.entries(cost).map(e=>`${e[1]} ${e[0]}`).join(' / ')||'â€”';const speed=Math.max(0.5,(g.baseInterval/Math.max(1,g.level)));const div=document.createElement('div');div.innerHTML=`<div style="font-weight:800">${prettyGenName(k)} (Level ${g.level})</div><div class="smallmuted">Upgrade cost: <span class="price">${costText}</span></div><div class="smallmuted">Approx interval: ${speed}s</div><button class="small" onclick="upgradeGenerator('${k}')">Upgrade</button>`;c.appendChild(div);}}
function renderEggs(){const c=document.getElementById('eggs');c.innerHTML='';if(state.eggs.length===0){c.innerHTML='<div class="smallmuted">No eggs yet</div>';return;}state.eggs.forEach(e=>{const div=document.createElement('div');div.className='egg';div.innerHTML=`${e.name} [${e.ready?'Ready':'Hatching...'}] <button class="small" ${e.ready?'':'disabled'} onclick="hatchEgg('${e.id}')">HATCH</button>`;c.appendChild(div);});}
function renderAliens(){const c=document.getElementById('collected');c.innerHTML='';if(state.aliens.length===0){c.innerHTML='<span class="smallmuted">No aliens collected</span>';return;}state.aliens.forEach(a=>{const div=document.createElement('div');div.className='alienCard';div.innerHTML=`<span>${a.name} (${a.rarity})</span>`;c.appendChild(div);});}
function renderEquipList(){const c=document.getElementById('equipList');c.innerHTML='';state.aliens.forEach(a=>{const btn=document.createElement('button');btn.className='equipBtn';btn.innerText=a.name;btn.onclick=()=>equipAlien(a.id);c.appendChild(btn);});}
function renderStation(){const c=document.getElementById('station');c.innerHTML='';for(const k in stationItems){const owned=state.station[k]||false;const s=stationItems[k];const costText=Object.entries(s.cost).map(e=>`${e[1]} ${e[0]}`).join(' / ');const btn=document.createElement('button');btn.innerText=owned?'Owned':'Buy';btn.disabled=owned||!canAfford(s.cost);btn.onclick=()=>buyStation(k);const div=document.createElement('div');div.innerHTML=`<div style="font-weight:800">${s.name}</div><div class="smallmuted">${s.desc}</div>`;div.appendChild(btn);c.appendChild(div);}}
function renderAchievements(){const c=document.getElementById('achievements');c.innerHTML='';if(state.achievements.length===0){c.innerHTML='<span class="smallmuted">None yet</span>';return;}state.achievements.forEach(a=>{const div=document.createElement('div');div.className='badge';div.innerText=a; c.appendChild(div);});}

/* ==========================
USER INTERACTIONS
========================== */
function setUsername(){const val=document.getElementById('usernameInput').value.trim();if(val){state.username=val;log(`Username set to ${val}`);if(val==='imachillguy67'){state.isAdmin=true;showAdminPanel();}}else alert('Enter a valid name');}
function openHowTo(){document.getElementById('howto').classList.remove('hidden');}
function closeHowTo(){document.getElementById('howto').classList.add('hidden');}
function manualMine(){state.resources.ore+=1;log('You mined 1 ore'); renderResources();}
function manualEnergy(){state.resources.energy+=1;log('You generated 1 energy'); renderResources();}

/* ==========================
FACTORY / GENERATOR LOGIC
========================== */
function buyFactory(k){const f=factoriesDef[k];if(canAfford(f.cost)){payCost(f.cost);state.factories[k]=(state.factories[k]||0)+1;log(`Bought 1 ${f.name}`);renderFactories();renderResources();}else alert('Cannot afford');}
function upgradeGenerator(k){const g=state.generators[k];const cost=scaledCost(g.baseCost,g.level);if(canAfford(cost)){payCost(cost);g.level+=1;log(`Upgraded ${prettyGenName(k)} to level ${g.level}`);renderGenerators();renderResources();}else alert('Cannot afford');}

/* ==========================
EGGS / ALIENS
========================== */
function unlockAllEggs(){state.generators.basicGen.level>0 && generateEgg('basicGen'); state.generators.advancedGen.level>0 && generateEgg('advancedGen'); state.generators.exoticGen.level>0 && generateEgg('exoticGen');}
function generateEgg(genKey){const g=state.generators[genKey];const possible=alienPool[Math.floor(Math.random()*alienPool.length)];const e={id:randId('egg'),name:possible.name,ready:true,alien:possible};state.eggs.push(e);renderEggs();}
function hatchEgg(id){const idx=state.eggs.findIndex(e=>e.id===id);if(idx<0)return;const e=state.eggs[idx];state.aliens.push({...e.alien,id:randId('alien')});state.eggs.splice(idx,1);log(`Hatched ${e.name}!`);renderEggs();renderAliens();renderEquipList();checkAchievements();}

/* ==========================
EQUIP ALIEN
========================== */
function equipAlien(id){state.equippedAlienId=id;const a=state.aliens.find(x=>x.id===id);if(!a)return;document.body.style.background=`linear-gradient(135deg,${a.colorA},${a.colorB})`;log(`Equipped ${a.name}`);}

/* ==========================
STATION PURCHASES
========================== */
function buyStation(k){if(state.station[k])return;const s=stationItems[k];if(canAfford(s.cost)){payCost(s.cost);state.station[k]=true;log(`Bought ${s.name}`);renderStation();renderResources();}else alert('Cannot afford');}

/* ==========================
ACHIEVEMENTS
========================== */
function checkAchievements(){if(state.aliens.length>=1 && !state.achievements.includes('First Hatch'))state.achievements.push('First Hatch');
if(state.aliens.length>=5 && !state.achievements.includes('Alien Collector'))state.achievements.push('Alien Collector');
if(state.factories.oreFactory>=5 && !state.achievements.includes('Factory Builder'))state.achievements.push('Factory Builder');
renderAchievements();}

/* ==========================
SAVE / LOAD
========================== */
function saveNow(){state.lastSaved=new Date().toISOString();localStorage.setItem(SAVE_KEY,JSON.stringify(state));log('Game Saved');}
function loadGame(){const d=localStorage.getItem(SAVE_KEY);if(d){state=JSON.parse(d);renderAll();log('Game Loaded');}}
function resetGame(){if(confirm('Reset everything?')){localStorage.removeItem(SAVE_KEY);location.reload();}}

/* ==========================
AUTOMATION
========================== */
function autoTick(){for(const k in state.factories){const f=factoriesDef[k];const cnt=state.factories[k]||0;if(cnt>0){if(f.produce)for(const r in f.produce){state.resources[r]=(state.resources[r]||0)+f.produce[r]*cnt;}}}renderResources();}
setInterval(autoTick,1000); // every second
setInterval(saveNow,10000); // autosave every 10s

/* ==========================
RENDER ALL
========================== */
function renderAll(){renderResources();renderFactories();renderGenerators();renderEggs();renderAliens();renderEquipList();renderStation();renderAchievements();}
loadGame();

/* ==========================
ADMIN PANEL
========================== */
function showAdminPanel(){const c=document.getElementById('adminPanelBtn');c.innerHTML='<button class="admin" onclick="openAdmin()">Admin Panel</button>';}
function openAdmin(){
const panel=document.createElement('div');panel.className='modal';panel.innerHTML=`
<h2>ADMIN PANEL</h2>
<div style="display:flex;flex-direction:column;gap:8px;">
<button onclick="adminAddResource('ore',1000)">+1000 Ore</button>
<button onclick="adminAddResource('energy',1000)">+1000 Energy</button>
<button onclick="adminAddResource('metal',500)">+500 Metal</button>
<button onclick="adminUnlockAllAliens()">Unlock All Aliens</button>
<button onclick="closeAdmin()">Close</button>
</div>
`;document.body.appendChild(panel);panel.id='adminPanel';}
function closeAdmin(){const el=document.getElementById('adminPanel');el?.remove();}
function adminAddResource(r,n){state.resources[r]=(state.resources[r]||0)+n;renderResources();log(`Admin added ${n} ${r}`);}
function adminUnlockAllAliens(){alienPool.forEach(a=>{if(!state.aliens.find(x=>x.name===a.name))state.aliens.push({...a,id:randId('alien')})});renderAliens();renderEquipList();log('Admin unlocked all aliens');}

/* ==========================
BRAINROT / ASCII EFFECTS
========================== */
const phrases=["this is fine","wow brainrot","simulation online","galaxy mode","epic factory"]; 
let idx=0;
setInterval(()=>{if(state.station.robloxExperience){document.getElementById('brainrot').innerText=phrases[idx++%phrases.length];}},5000);
setInterval(()=>{if(state.station.artGallery){document.getElementById('asciiArt').innerHTML='âœ¨ * ~ ASCII Art ~ * âœ¨';}},60000);

</script>

</body>
</html>
